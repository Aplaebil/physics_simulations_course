\documentclass[a4paper, twoside, symmetric, nobib, nohyper]{tufte-book}
% \usepackage[a4paper, margin=2cm]{geometry}
\usepackage{parskip}
\setlength{\parskip}{1.5em}

% Bibliography
\usepackage[
    backend=biber,
    style=authoryear-icomp,
    sortlocale=de_DE,
    natbib=true,
    url=false, 
    doi=true,
    eprint=false
]{biblatex}
\addbibresource{ref/references.bib}
% Math packages
\usepackage{amsthm, commath, bm}

% Physics stuff
\usepackage{physics}

% Graphics
\usepackage{tikz}
\usetikzlibrary{calc, positioning, arrows.meta, decorations.pathmorphing, decorations.text, decorations.pathreplacing, patterns}
\tikzset{
  springcoil/.style={thick, decoration={aspect=0.3, segment length=3mm, amplitude=3mm, coil}, decorate},
}

% Colors
\definecolor{xred}{HTML}{BD4242}
\definecolor{xblue}{HTML}{4268BD}
\definecolor{xgreen}{HTML}{52B256}
\definecolor{xpurple}{HTML}{7F52B2}
\definecolor{xorange}{HTML}{FD9337}
\definecolor{xdotted}{HTML}{999999}
\definecolor{xgray}{HTML}{777777}
\definecolor{xcyan}{HTML}{80F5DC}
\definecolor{xpink}{HTML}{F690EA}
\definecolor{xgrayblue}{HTML}{49B095}
\definecolor{xgraycyan}{HTML}{5AA1B9}

\colorlet{xdarkred}{xred!50!black}
\colorlet{xdarkblue}{xblue!50!black}
\colorlet{xdarkgreen}{xgreen!50!black}
\colorlet{xdarkpurple}{xpurple!50!black}
\colorlet{xdarkorange}{xorange!50!black}

% \usepackage{enumitem}

% Font-related stuff
\usepackage{fontawesome}

% Fancy environments
\usepackage[most]{tcolorbox}
\newenvironment{descitemize}
{\begin{description}[leftmargin=*, before=\let\makelabel\descitemlabel]}
{\end{description}}
\newcommand{\descitemlabel}[1]{\textbullet\ \textbf{#1}:}

\usepackage[most]{tcolorbox}

\tikzset{
	second box/.style={
		anchor=east,
		text=white,
		% rounded corners,
		fill=#1,
		xshift=-4mm,
	},
}
\tikzset{tcbreak/.style = {fill=white, thick, draw=#1, text=#1, font=\bfseries}}
\tcbset{
	common/.style n args={2}{
		colframe={#1},
		colback={#1!5},
		colbacktitle={#1},
		lower separated=false,
		coltitle=white,
		boxrule=1pt,
		fonttitle=\bfseries,
		enhanced,
		breakable,
		top=8pt,
		sharp corners,
		before skip=1em,
		after skip=2em,
		attach boxed title to top left={
			yshift=-0.25cm,
			xshift=0.38cm,
		},
		boxed title style={
			boxrule=0pt,
			colframe=white,
			arc=0pt,
			outer arc=0pt,
		},
		separator sign={~~},
		% -- overlays based on the following TeX SE answer: https://tex.stackexchange.com/a/545324/162087
		overlay unbroken={
			\node[text=white, align=right, fill=#1, xshift=-4mm, minimum height=6mm, anchor=east] at (frame.south east) {#2};
		},
		overlay first={
			\draw[thick, #1, decoration={coil, amplitude=0.5mm}, decorate]
				(frame.south west) -- (frame.south east);
			\path[font=\small\itshape] (frame.south) node [tcbreak={#1}] (cont) {continues in the next page \faHandORight};
		},
		overlay middle={%
			% upper break
			\draw[thick, #1, decoration={coil, amplitude=0.5mm}, decorate]
				(frame.north west) -- (frame.north east);
			\path[font=\small\itshape] (frame.north) node [tcbreak={#1}] (cont) {\faHandORight continues from the previous page};

			% lower break
			\draw[thick, #1, decoration={coil, amplitude=0.5mm}, decorate]
				(frame.south west) -- (frame.south east);
			\path[font=\small\itshape] (frame.south) node [tcbreak={#1}] (cont) {continues in the next page \faHandORight};
		},
		overlay last={
			\node[text=white, align=right, fill=#1, xshift=-4mm, minimum height=6mm, anchor=east] at (frame.south east) {#2};
			\draw[thick, #1, decoration={coil, amplitude=0.5mm}, decorate]
				(frame.north west) -- (frame.north east);
			\path[font=\small\itshape] (frame.north) node [tcbreak={#1}] (cont) {\faHandORight continues from the previous page};
		}
	},
	defstyle/.style={
		common={xpurple}{$\bm{\pi}$},
	},
	theoremstyle/.style={
		common={xgraycyan}{$\multimapdotbothA$},
	},
	lemmastyle/.style={
		common={xgrayblue}{$\multimap$},
	},
	proofstyle/.style={
		common={xgreen}{\textbf{QED}},
	},
	examplestyle/.style={
		common={xblue}{\faStar},
	},
	notestyle/.style={
		common={xred}{\textbf{!}},
	},
	challengestyle/.style={
		common={xgreen}{\textbf{?}},
	},
	quotestyle/.style={
		common={gray}{\textbf{"}},
	},
}

\newtcbtheorem[auto counter, number within=section]{definition}{Definition}{defstyle}{def}
\newtcbtheorem[auto counter, number within=section]{theorem}{Theorem}{theoremstyle}{theorem}
\newtcbtheorem[auto counter, number within=section]{lemma}{Lemma}{lemmastyle}{lemma}
% \newtcbtheorem[auto counter, number within=section]{proof}{Proof}{proofstyle}{proof}
\newtcbtheorem[auto counter, number within=section]{example}{Example}{examplestyle}{example}
\newtcbtheorem[auto counter, number within=section]{note}{Note}{notestyle}{note}
\newtcbtheorem[auto counter, number within=section]{challenge}{Challenge}{challengestyle}{challenge}

% For code samples
\usepackage{listings}

%
\usepackage{booktabs}
\usepackage{hyperref}
% \usepackage{cleveref}

% Text stuff
\usepackage{csquotes}

% Content related-stuff
\title{Physics Simulations\\(Lecture Notes)}
% NOTE: add mote details!
\author{Peleg Bar Sapir}

%%%% MAIN DOC %%%%

\begin{document}
\maketitle

% For tests
\ifdefined\testcode
  \section{Tests}
  This is a test. And this is a reference to some code: \autoref{lst:code1}.
  \input{code/maths}

  And this is a TikZ drawing: \autoref{fig:tikztest}.

  \begin{figure}
      \begin{center}
      \begin{tikzpicture}
        \draw[-stealth, thick] (0,0) -- (2,1) node[midway, above] {$\vec{a}$};
        \draw[-stealth, thick, blue] (2,1) -- ++(-1,-3) node[midway, right] {$\vec{b}$};
      \end{tikzpicture}
      \end{center}
    \caption{A figure.}\label{fig:tikztest}
  \end{figure}
  
\else
\fi

% Content
\input{sections/intro}
\input{sections/mechanics}
\input{sections/waves}
\input{sections/thermodynamics}
\input{sections/molecular_dynamics}

\end{document}
