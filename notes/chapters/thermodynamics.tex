\chapter{Thermodynamics}

\section{Preface}
Text text text

\section{Ideal gas}
\subsection{Theory}
There are several commonly used models for the behaviour of gasses. A very simple yet powerful one is the \textbf{ideal gas} model: it describes gas particles as being perfect spheres which move around in an enclosed container and undergo elastic collisions with other particles and the walls of the container. In common conditions such as atmospheric pressure and temperatures around $\SI{300}{\kelvin}$, gasses such as helium (\ce{He}), argon (\ce{Ar}), nitrogen (\ce{N2}), oxygen (\ce{O2}) and carbon dioxide (\ce{CO2}) behave like ideal gasses (assuming no chemical reations take place). However, the ideal gas model fails under high pressures, low temperatures, chemical interactions and some physical processes such as adsorption or multipolar interactions.

The principle equation describing an ideal gas is the \textbf{ideal gas law}:
\begin{equation}
	PV = nRT,
	\label{eq:ideal_gas_law}
\end{equation}
where (SI units in parentheses):
\begin{itemize}
	\item $P$ is the pressure of the gas ($\si{\pascal}$),
	\item $V$ is the volume of the container ($\si{\cubic\metre}$),
	\item $n$ is the amount of gas ($\si{\mol}$),
	\item $R$ is the \textbf{gas constant}, $R=\SI{8.314}{\joule\per\kelvin\per\mol}$, and
	\item $T$ is the temperature of the gas ($\si{\kelvin}$).
\end{itemize}

\subsubsection{Maxwell-Boltzman distribution}
\subsubsection{Mean free path}
\subsubsection{Temperature from energy}

\subsection{Simulating an ideal gas using perfectly elastic spheres}
Text text text

% subsubsection: sphere-wall collision
\subsubsection{Sphere-wall collision}
An elastic collision between a particle and a wall causes the particle's velocity to flip in the direction of the wall's normal (\autoref{fig:particle_wall_collision}).

\begin{figure}
	\begin{center}
		\begin{tikzpicture}
			\draw[thick, fill=black!25] (-4,-0.5) rectangle (4,0);
			\draw[vector={xred}]  (3,3) -- (0,0)  node [midway, below right] {$\vec{v}$};
			\draw[vector={xblue}] (0,0) -- (-3,3) node [midway, below left]  {$\vec{u}$};
			\draw[vector={black}, dashed] (0,0) -- (0,3) node [pos=1.1] {$\hat{n}$};
			\draw[filledangle={xred}] (0,0) -- (1,1) arc (45:90:{sqrt(2)}) node [above, pos=0.4] {$\theta$};
			\draw[filledangle={xblue}] (0,0) -- (0,{sqrt(2)}) arc (90:135:{sqrt(2)}) node [above, pos=0.4] {$\theta$};
		\end{tikzpicture}
	\end{center}
	\caption{Collision of a particle and a wall. The particle bounces in such a way that the component of its velocity $\vec{v}$ in the direction of the wall's normal $\hat{n}$ is flipped. The resulting velocity $\vec{u}$ has the same angle to $\hat{n}$ as $\vec{v}$ does.}
	\label{fig:particle_wall_collision}
\end{figure}

The component of $\vec{v}$ in the direction of $\hat{n}$ is
\begin{equation}
	\vec{v}_{\parallel} = \innerproduct{\vec{v}}{\hat{n}}\hat{n}.
	% \label{eq:label}
\end{equation}
Therefore, the component of $\vec{v}$ orthogonal to $\hat{n}$ is
\begin{equation}
	\vec{v}_{\perp} = \vec{v} - \vec{v}_{\parallel} = \vec{v} - \innerproduct{\vec{v}}{\hat{n}}\hat{n}.
	% \label{eq:label}
\end{equation}
In the case of $\vec{u}$, the orthogonal component is the same as that of $\vec{v}$, but the parallel component is inverted:
\begin{equation}
	\begin{aligned}
		\vec{u}_{\perp}     & = \vec{v}_{\perp},      \\
		\vec{u}_{\parallel} & = -\vec{v}_{\parallel}.
	\end{aligned}
	% \label{eq:label}
\end{equation}
and altogether we get
\begin{equation}
	\begin{aligned}
		\vec{u} & = \vec{u}_{\perp} + \vec{u}_{\parallel}                                                     \\
		        & = \vec{v} - \innerproduct{\vec{v}}{\hat{n}}\hat{n} - \innerproduct{\vec{v}}{\hat{n}}\hat{n} \\
		        & = \vec{v}-2\innerproduct{\vec{v}}{\hat{n}}\hat{n}.
	\end{aligned}
	\label{eq:elastic_sphere_wall_collision}
\end{equation}

\begin{example}{A simple sanity check}{}
	To make a simple validation of this equation, let's examine the case for a collision with a wall which is oriented in the $xy$-plane (i.e. its normal points in the $z$-direction): given the velocity $\vec{v}=\colvec{v_{x};v_{y};v_{z}}$, \autoref{eq:elastic_sphere_wall_collision} becomes
	\begin{align*}
		\vec{u} & = \vec{v}-2\innerproduct{\vec{v}}{\hat{n}}\hat{n}                                                     \\
		        & = \colvec{v_{x};v_{y};v_{z}}-2\innerproduct{\colvec{v_{x};v_{y};v_{z}}}{\colvec{0;0;1}}\colvec{0;0;1} \\
		        & = \colvec{v_{x};v_{y};v_{z}}-2(\cancel{v_{x}\cdot0}+\cancel{v_{y}\cdot0}+v_{z}\cdot1)\colvec{0;0;1}   \\
		        & = \colvec{v_{x};v_{y};v_{z}}-2v_{z}\colvec{0;0;1}                                                     \\
		        & = \colvec{v_{x};v_{y};v_{z}}-2\colvec{0;0;v_{z}}                                                      \\
		        & =  \colvec{v_{x};v_{y};v_{z}}+\colvec{0;0;-2v_{z}}                                                    \\
		        & =  \colvec{v_{x};v_{y};-v_{z}},
	\end{align*}
	as expected.
\end{example}

\begin{note}{Studying advice}{}
	The reader is encouraged to repeat the above calculation for the cases of walls oriented in the $xz$- and $yz$-planes.
\end{note}

When a sphere collides with a wall, the distance $d$ from the center of the sphere to the wall is exactly $r$, the radius of the sphere. The distance between a point $\bm{P}$ and a plane $\bm{\pi}$ can be defined as follows: start from $\bm{P}$ and move along the direction $\pm\hat{n}$ (where $\hat{n}$ is the normal to the plane) until the plane is intersected at a point $\bm{B}$. The distance between $\bm{P}$ and $\bm{\pi}$ is then the length $\bm{PB}$ (\autoref{fig:point_plane_distance_1}).

\begin{figure}
	\forcecaptionside
	\begin{center}
		\tdplotsetmaincoords{70}{200}
		\begin{tikzpicture}[tdplot_main_coords, rotate=30]
			\coordinate (P) at (-1.2,-0.5,2);
			\coordinate (B) at (-1.2,-0.5,0);
			\draw[thick, fill=xblue, fill opacity=0.25] (-2,-2,0) -- (2,-2,0) -- (2,2,0) -- (-2,2,0) -- cycle;
			\node at (1.5,1,0) {$\bm{\pi}$};
			\fill[xred] (P) circle (0.05) node[above] {$\bm{P}$};
			\fill (B) circle (0.05) node[right] {$\bm{B}$};
			\draw[thick, dashed, black!50] (P) -- (B);
			\draw[vector={xblue}] (0,0,0) -- (0,0,1.5) node[above] {$\hat{n}$};
		\end{tikzpicture}
	\end{center}
	\caption{The distance between a point $\bm{P}$ and a plane $\bm{\pi}$. The distance from $\bm{P}$ to the plane $\bm{\pi}$ is the length $\bm{PB}$.}
	\label{fig:point_plane_distance_1}
\end{figure}

If we know a point $\bm{A}$ on the plane, then we can the vector $\vec{c}$ as starting at $\bm{A}$ and ending at $\bm{P}$ (i.e. corresponding to the line segment $\overline{\bm{AP}}$). The projection of $\vec{c}$ onto $\hat{n}$ then gives the length $\bm{PM}$ (\autoref{fig:point_plane_distance_2}).

\begin{figure}
	\forcecaptionside
	\begin{center}
		\tdplotsetmaincoords{70}{200}
		\begin{tikzpicture}[tdplot_main_coords, rotate=30]
			\coordinate (P) at (-1.2,-0.5,2);
			\coordinate (B) at (-1.2,-0.5,0);
			\coordinate (A) at (-0.5,-0.25,0);
			\draw[thick, fill=xblue, fill opacity=0.25] (-2,-2,0) -- (2,-2,0) -- (2,2,0) -- (-2,2,0) -- cycle;
			\node at (1.5,1,0) {$\bm{\pi}$};
			\fill[xred] (P) circle (0.05) node[above] {$\bm{P}$};
			\fill (B) circle (0.05) node[right] {$\bm{B}$};
			\draw[thick, dashed, black!50] (P) -- (B);
			\draw[vector={xblue}] (0,0,0) -- (0,0,1.5) node[above] {$\hat{n}$};
			\fill[xpurple] (A) circle (0.05) node[right] {$\bm{A}$};
			\draw[vector={xpurple}] (A) -- (P) node [midway, left] {$\vec{c}$};
		\end{tikzpicture}
	\end{center}
	\caption{The vector $\vec{c}$ connects a known point on the plane $\bm{A}$ and the point $\bm{P}$. Its projection on $\hat{n}$ gives the distance $\bm{PB}$.}
	\label{fig:point_plane_distance_2}
\end{figure}

Since $\hat{n}$ is a unit vector, the projection of $\vec{c}$ onto it is simply the dot product between the two vectors, i.e. the distance $d$ of point $\bm{P}$ and the plane $\bm{\pi}$ is
\begin{equation}
	d = \innerproduct{\vec{c}}{\hat{n}}.
	\label{eq:distance_point_plane_as_dot_product}
\end{equation}

\begin{example}{Distance of a point and a plane - sanity check}{}
	Let $\bm{P}=(2,-4,3)$. Let's calculate its distance to the three principle planes $xy$, $xz$ and $yz$. We will use the origin as the point $\bm{A}$, since all of these planes contain it. In each case, $\vec{c}$ will have as components the respective coordinates of $\bm{P}$.
	\begin{enumerate}
		\item The normal to the $xy$-plane is $\hat{z}=\colvec{0;0;1}$. The dot product $\innerproduct{\vec{c}}{\hat{n}}$ is therefore $d=\cancel{2\cdot0}+\cancel{(-4)\cdot0}+3\cdot1=3$.
		\item The normal to the $xz$-plane is $\hat{y}=\colvec{0;1;0}$. The dot product $\innerproduct{\vec{c}}{\hat{n}}$ is therefore $d=\cancel{2\cdot0}+(-4)\cdot1+\cancel{3\cdot0}=-4$.
		\item The normal to the $yz$-plane is $\hat{x}=\colvec{1;0;0}$. The dot product $\innerproduct{\vec{c}}{\hat{n}}$ is therefore $d=2\cdot1+\cancel{(-4)\cdot0}+\cancel{3\cdot0}=2$.
	\end{enumerate}

	As expected, the distance we get from $\bm{P}$ to each of the principle planes in $\Rs[3]$ using \autoref{eq:distance_point_plane_as_dot_product} is exactly the respective coordinate of $\bm{P}$.
\end{example}


\subsubsection{Sphere-sphere collision}
Consider two solid spheres which have a single point of contact $\bm{A}$. Let $m_{1}, r_{1}, \vec{x}_{1}$ and $\vec{v}_{1}$ be the mass, radius, position and velocity of the first sphere, and $m_{2}, r_{2}, \vec{x}_{2}$ and $\vec{v}_{2}$ the respective quantities for the second sphere (\autoref{fig:elastic_collision}). The line connecting the centers of the two spheres is in the direction $\hat{n}$ (without loss of generality let us assume that the normal vector $\hat{n}$ points from $\vec{x}_{1}$ towards $\vec{x}_{2}$). The unit vector $\hat{t}$ is orthogonal to $\hat{n}$ (and without loss of generality we will assume that it is oriented counter-clockwise from $\hat{n}$).

\begin{figure}
	\begin{center}
		\begin{tikzpicture}
			\coordinate (xA) at (0, 0);
			\pgfmathsetmacro{\rA}{2}
			\pgfmathsetmacro{\rB}{1.5}
			\pgfmathsetmacro{\th}{45}
			\coordinate (xB) at ({(\rA+\rB)*cos(\th)},{(\rA+\rB)*sin(\th)});
			\coordinate (uAB) at ({\rA*cos(\th)},{\rA*sin(\th)});
			\draw[thick, dashed, black!50] (xA) -- (xB);

			\tikzset{
				sphere/.style={thick, fill=#1, fill opacity=0.3},
				radius/.style={thick, dashed, draw=#1},
			}
			\draw[sphere={xblue}]  (xA) circle (\rA);
			\draw[sphere={xgreen}] (xB) circle (\rB);
			\fill (xA) circle (0.05) node [above left]  {$m_{1}$};
			\fill (xB) circle (0.05) node [above right] {$m_{2}$};
			\draw[radius={xblue!75}] (xA) -- ++(0,-\rA) node [xblue!75, midway, right] {$r_{1}$};
			\draw[radius={xdarkgreen!75}] (xB) -- ++(0,-\rB) node [xdarkgreen!75, midway, right]  {$r_{2}$};

			\draw[vector={xblue}] (xA) -- ++(3,-0.5) node [pos=1.1] {$\vec{v}_{1}$};
			\draw[vector={xdarkgreen}] (xB) -- ++(-2,1.0) node [pos=1.1] {$\vec{v}_{2}$};

			\draw[vector={xred}] (uAB) -- ++({cos(\th)},{sin(\th)}) node [midway, above left] {$\hat{n}$};
			\draw[vector={xred}] (uAB) -- ++({cos(\th+90)},{sin(\th+90)}) node [pos=1.1] {$\hat{t}$};
		\end{tikzpicture}
	\end{center}
	\caption{Text text text}
	\label{fig:elastic_collision}
\end{figure}

Note that we did not define a coordinate system, nor the number of dimensions $d$ for the problem. The only restriction is that $d\geq2$.

Conservation of momentum means that the velocities of the spheres following the collision, $\vec{u}_{1},\vec{u}_2$, are related to their velocities before the collision by
\begin{equation}
	\begin{aligned}
		                 & m_{1}\vec{v}_{1} + m_{2}\vec{v}_{2} = m_{1}\vec{u}_{1} + m_{2}\vec{u}_{2}                   \\
		\Rightarrow\quad & m_{1}\left(\vec{v}_{1} - \vec{u}_{1}\right)  = m_{2}\left(\vec{u}_{2} - \vec{v}_{2}\right).
	\end{aligned}
	\label{eq:elastic_collision_coservation_of_momentum}
\end{equation}

Conservation of energy means that the velocities are also related by
\begin{equation}
	\begin{aligned}
		                 & \frac{1}{2}m_{1}\norm{\vec{v}_{1}}^{2} + \frac{1}{2}m_{2}\norm{\vec{v}_{2}}^{2} = \frac{1}{2}m_{1}\norm{\vec{u}_{1}}^{2} + \frac{1}{2}m_{2}\norm{\vec{u}_{2}}^{2} \\
		\Rightarrow\quad & m_{1}\left(\norm{\vec{v}_{1}}^{2} - \norm{\vec{u}_{1}}^{2}\right) = m_{2}\left(\norm{\vec{u}_{2}}^{2} - \norm{\vec{v}_{2}}^{2}\right).
	\end{aligned}
	\label{eq:elastic_collision_coservation_of_energy}
\end{equation}

However, the forces involved in the collision can not have a component in the $\hat{t}$ direction, and are limited to only point in the $\hat{n}$ direction. Therefore, we can reduce the problem to this direction only by projecting all velocities involved in the problem on $\hat{n}$, i.e. \autoref{eq:elastic_collision_coservation_of_momentum} becomes
\begin{equation}
	m_{1}\innerproduct{\vec{v}_{1}}{\hat{n}} + m_{2}\innerproduct{\vec{v}_{2}}{\hat{n}} = m_{1}\innerproduct{\vec{u}_{1}}{\hat{n}} + m_{2}\innerproduct{\vec{u}_{2}}{\hat{n}}.
	\label{eq:elastic_collision_coservation_of_momentum_projection}
\end{equation}

TEXT TEXT TEXT

\begin{equation}
	\begin{aligned}
		\vec{u}_{1} & = \vec{v}_{1} - \frac{2m_{2}}{m_{1}+m_{2}}\innerproduct{\vec{v}_{1}-\vec{v}_{2}}{\hat{n}}\hat{n}, \\
		\vec{u}_{2} & = \vec{v}_{2} + \frac{2m_{1}}{m_{1}+m_{2}}\innerproduct{\vec{v}_{1}-\vec{v}_{2}}{\hat{n}}\hat{n}.
	\end{aligned}
\end{equation}

To avoid reduntant calculations, we can factor out the common quantity of both velocities:
\begin{equation}
	K = \frac{2}{m_{1}+m_{2}}\innerproduct{\vec{v}_{1}-\vec{v}_{2}}{\hat{n}}\hat{n},
	\label{eq:elastic_collision_common_quantity}
\end{equation}
yielding
\begin{equation}
	\begin{aligned}
		\vec{u}_{1} & = \vec{v}_{1}-Km_{2}, \\
		\vec{u}_{2} & = \vec{v}_{2}+Km_{1}.
	\end{aligned}
	\label{eq:elastic_collision_final_equation}
\end{equation}

\subsubsection{Reducing collision test complexity}
% BBOX, Neighbor lists, etc.

\section{Brownian dynamics}
